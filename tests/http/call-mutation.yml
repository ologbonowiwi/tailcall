---
config: !file tests/http/config/call-mutation.graphql
name: Call mutation

mock:
  - request:
      method: POST
      url: http://jsonplaceholder.typicode.com/posts
      body: '{"body":"post-body","title":"post-title","userId":1}'
    response:
      body:
        title: "post-title"
        body: "post-body"
        userId: 1
  - request:
      method: POST
      url: http://jsonplaceholder.typicode.com/posts
      body: '{"body":"user-body","title":"user-title","userId":1}'
    response:
      body:
        title: "user-title"
        body: "body"
        userId: 1
  - request:
      method: GET
      url: http://jsonplaceholder.typicode.com/users/1
    response:
      body:
        id: 1
        name: foo

assert:
  - request:
      method: POST
      url: http://localhost:8080/graphql
      body:
        query: 'mutation { insertPost(input: { body: "post-body", title: "post-title", userId: 1 }) { body } }'
    response:
      body:
        data:
          insertPost:
            body: "post-body"
  - request:
      method: POST
      url: http://localhost:8080/graphql
      body:
        query: "query { firstUser { post { title } } }"
    response:
      body:
        data:
          firstUser:
            post:
              title: "user-title"
